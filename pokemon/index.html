<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Hoenn </title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>

    <canvas id="mapCanvas"></canvas>

    <script>
        const canvas = document.getElementById('mapCanvas');
        const ctx = canvas.getContext('2d');
        const mapImage = new Image();
        mapImage.src = 'mapa.jpg';
        const SPRITE_WIDTH = 110;
        const SPRITE_HEIGHT = 110;
        const LAVARIDGE_X = 420; 
        const LAVARIDGE_Y = 150;
        const SPRITE_DRAW_X = LAVARIDGE_X - SPRITE_WIDTH / 2;
        const SPRITE_DRAW_Y = LAVARIDGE_Y - SPRITE_HEIGHT / 2; 
        const frameSources = ['Sprite1.png', 'sprite2.png', 'sprite3.png', 'sprite4.png', 'sprite5.png', 'sprite6.png', 'sprite7.png'];
        const frames = frameSources.map(() => new Image());
        let currentFrameIndex = 0;
        let loadedCount = 0;
        let lastFrameTime = 0;
        const frameInterval = 200; 
        let mapLoaded = false;
        let allFramesLoaded = false;
        let canvasInitialized = false;

        mapImage.onload = () => {
            mapLoaded = true;
            if (!canvasInitialized) {
                initializeCanvas();
            }
            startGameLoop();
        };

        mapImage.onerror = () => {
            console.error('Erro ao carregar mapa.jpg');
            canvas.width = 1280;
            canvas.height = 720;
            canvasInitialized = true;
            startGameLoop();
        };

        function initializeCanvas() {
            canvas.width = mapImage.width;
            canvas.height = mapImage.height;
            canvasInitialized = true;
        }

        function loadFrames() {
            frameSources.forEach((src, index) => {
                frames[index].src = src; 
                frames[index].onload = () => {
                    loadedCount++;
                    if (loadedCount === frameSources.length) {
                        allFramesLoaded = true;
                        startGameLoop();
                    }
                };
                frames[index].onerror = () => {
                    console.error(`Erro ao carregar o frame: ${src}`);
                    loadedCount++;
                    if (loadedCount === frameSources.length) {
                        allFramesLoaded = true;
                        startGameLoop();
                    }
                };
            });
        }

        function update(timestamp) {
            if (timestamp - lastFrameTime > frameInterval) {
                currentFrameIndex = (currentFrameIndex + 1) % frames.length;
                lastFrameTime = timestamp;
            }
        }

        function draw() {

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            if (mapLoaded) {
                ctx.drawImage(mapImage, 0, 0);
            } else {

                ctx.fillStyle = '#333';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
            
            if (frames.length > 0 && frames[currentFrameIndex].complete) {
                const currentFrame = frames[currentFrameIndex];
                ctx.drawImage(currentFrame, SPRITE_DRAW_X, SPRITE_DRAW_Y, SPRITE_WIDTH, SPRITE_HEIGHT);
            }
        }

        function gameLoop(timestamp) {
            update(timestamp);
            draw();
            requestAnimationFrame(gameLoop);
        }

        function startGameLoop() {
            if (!canvasInitialized) {
                canvas.width = 1280;
                canvas.height = 720;
                canvasInitialized = true;
            }

            requestAnimationFrame(gameLoop);
        }


        loadFrames();

    </script>
</body>
</html>